import { COLOR_VISION_SINGLE_ITEM } from '@shopify/polaris-viz-core';
import { useEffect } from 'react';
import { useCallbackRef } from './useCallbackRef.esnext';
import { getEventName } from './ColorVisionA11y/utilities.esnext';

function useWatchActiveSeries(id, onIndexChange) {
  const onIndexChangeCallback = useCallbackRef(onIndexChange);
  useEffect(() => {
    const clearActiveSeriesListener = setActiveSeriesListener(id, onIndexChangeCallback);
    return () => clearActiveSeriesListener();
  }, [id, onIndexChangeCallback]);
}
function setActiveSeriesListener(id, onIndexChange) {
  const eventName = getEventName(id, COLOR_VISION_SINGLE_ITEM);
  window.addEventListener(eventName, onIndexChange);
  return () => {
    window.removeEventListener(eventName, onIndexChange);
  };
}

export { setActiveSeriesListener, useWatchActiveSeries };
