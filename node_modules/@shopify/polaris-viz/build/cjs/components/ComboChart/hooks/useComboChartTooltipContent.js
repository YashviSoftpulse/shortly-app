'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var React = require('react');
var polarisVizCore = require('@shopify/polaris-viz-core');
var flattenDataGroupToDataSeries = require('../../../utilities/flattenDataGroupToDataSeries.js');
var getAxisOptions = require('../../../utilities/getAxisOptions.js');

function useComboChartTooltipContent({
  data,
  renderTooltipContent,
  seriesColors,
  seriesNameFormatter
}) {
  const {
    theme
  } = polarisVizCore.useChartContext();
  return React.useCallback(activeIndex => {
    if (activeIndex === -1) {
      return null;
    }

    const tooltipData = [];
    let index = 0;
    data.forEach(({
      shape,
      name,
      series,
      yAxisOptions
    }) => {
      const yAxisOptionsWithDefaults = getAxisOptions.getYAxisOptionsWithDefaults(yAxisOptions);
      const data = {
        shape,
        name,
        data: []
      };
      series.forEach(({
        name,
        data: seriesData,
        color,
        isComparison
      }) => {
        const {
          value
        } = seriesData[activeIndex];
        data.data.push({
          key: `${seriesNameFormatter(name !== null && name !== void 0 ? name : '')}`,
          value: yAxisOptionsWithDefaults.labelFormatter(value),
          color: color !== null && color !== void 0 ? color : seriesColors[index],
          isComparison
        });
        index++;
      });
      tooltipData.push(data);
    });
    return renderTooltipContent({
      data: tooltipData,
      activeIndex,
      title: `${data[0].series[0].data[activeIndex].key}`,
      dataSeries: flattenDataGroupToDataSeries.flattenDataGroupToDataSeries(data),
      theme
    });
  }, [data, seriesColors, renderTooltipContent, theme, seriesNameFormatter]);
}

exports.useComboChartTooltipContent = useComboChartTooltipContent;
