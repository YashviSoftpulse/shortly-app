'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var React = require('react');
var polarisVizCore = require('@shopify/polaris-viz-core');

function useDataForHorizontalChart({
  data,
  isSimple,
  isStacked,
  labelFormatter
}) {
  const {
    characterWidths
  } = polarisVizCore.useChartContext();
  const allNumbers = React.useMemo(() => {
    return data.reduce((prev, cur) => {
      const numbers = cur.data.map(({
        value
      }) => value).filter(value => value !== null);
      return prev.concat(...numbers);
    }, []);
  }, [data]);
  const lowestNegative = React.useMemo(() => Math.min(0, ...allNumbers), [allNumbers]);
  const highestPositive = React.useMemo(() => Math.max(0, ...allNumbers), [allNumbers]);
  const longestLabel = React.useMemo(() => {
    if (!isSimple && !isStacked) {
      return {
        positive: 0,
        negative: 0
      };
    }

    const negativeTextSize = lowestNegative === 0 ? 0 : polarisVizCore.estimateStringWidth(`${labelFormatter(lowestNegative)}`, characterWidths) + polarisVizCore.HORIZONTAL_BAR_LABEL_OFFSET;
    const positiveTextSize = highestPositive === 0 ? 0 : polarisVizCore.estimateStringWidth(`${labelFormatter(highestPositive)}`, characterWidths) + polarisVizCore.HORIZONTAL_BAR_LABEL_OFFSET;
    return {
      negative: negativeTextSize,
      positive: positiveTextSize
    };
  }, [labelFormatter, isSimple, isStacked, highestPositive, lowestNegative, characterWidths]);
  const areAllZero = React.useMemo(() => {
    return !allNumbers.some(num => num !== null && num !== 0);
  }, [allNumbers]);
  const areAllNegative = React.useMemo(() => {
    if (areAllZero) {
      return false;
    }

    return !allNumbers.some(num => num !== null && num > 0);
  }, [areAllZero, allNumbers]);
  return {
    allNumbers,
    areAllNegative,
    highestPositive,
    longestLabel,
    lowestNegative
  };
}

exports.useDataForHorizontalChart = useDataForHorizontalChart;
