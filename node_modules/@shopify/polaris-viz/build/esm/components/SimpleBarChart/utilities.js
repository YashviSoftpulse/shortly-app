import { HORIZONTAL_BAR_LABEL_OFFSET } from '@shopify/polaris-viz-core';
import { estimateTrendIndicatorWidth } from '../TrendIndicator/utilities/estimateTrendIndicatorWidth.js';

/**
 * Returns the widths of the trend indicators associated with the highest positive value and the lowest negative value in the dataset, or 0 if the value doesn't have a trend indicator.
 */
function getLongestTrendIndicator(data, highestPositive, lowestNegative) {
  const longestTrendIndicator = data.reduce((longestTrendIndicator, series) => {
    var _metadata$trends;

    const {
      data: seriesData,
      metadata
    } = series;
    const trends = (_metadata$trends = metadata === null || metadata === void 0 ? void 0 : metadata.trends) !== null && _metadata$trends !== void 0 ? _metadata$trends : {};
    const trendEntries = Object.entries(trends);

    for (const [index, trend] of trendEntries) {
      const dataPoint = seriesData[index];

      if ((dataPoint === null || dataPoint === void 0 ? void 0 : dataPoint.value) === highestPositive) {
        var _trend$value;

        longestTrendIndicator.positive = estimateTrendIndicatorWidth((_trend$value = trend.value) !== null && _trend$value !== void 0 ? _trend$value : '').totalWidth;
      } else if ((dataPoint === null || dataPoint === void 0 ? void 0 : dataPoint.value) === lowestNegative) {
        var _trend$value2;

        longestTrendIndicator.negative = estimateTrendIndicatorWidth((_trend$value2 = trend.value) !== null && _trend$value2 !== void 0 ? _trend$value2 : '').totalWidth;
      }
    }

    return longestTrendIndicator;
  }, {
    positive: 0,
    negative: 0
  });

  if (longestTrendIndicator.positive > 0) {
    longestTrendIndicator.positive += HORIZONTAL_BAR_LABEL_OFFSET;
  }

  if (longestTrendIndicator.negative > 0) {
    longestTrendIndicator.negative += HORIZONTAL_BAR_LABEL_OFFSET;
  }

  return longestTrendIndicator;
}

export { getLongestTrendIndicator };
